<!DOCTYPE html><html><!-- UTF-8: SÃ­--><head><title>txt-to-sql</title><meta charset="UTF-8"><link rel="icon" href="txt-to-sql.png" type="image/png"><link rel="shortcut icon" href="txt-to-sql.png" type="image/png"><link rel="apple-touch-icon" href="txt-to-sql.png"></head><body><a href="https://github.com/codenautas/txt-to-sql"><img style="position: absolute; top: 0; right: 0; border: 0" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a><a href="https://github.com/codenautas/txt-to-sql/issues"><img style="position: absolute; top: 100px; right: 100px; border: 0" src="new-issue-es.png" alt="New issue"></a><div style="float:left;height:300px;margin:0px 30px"><img src="txt-to-sql.png"></div><h1>txt-to-sql</h1><div><label>Paso 1: </label><input value="Elegir" type="file" id="inputFile"></div><div id="steps"></div><div id="result"></div><pre id="log"></pre><pre id="errMessage" style="color:red"></pre></body><script>var module = {};</script><script src="require-bro.js"></script><script src="best-globals.js"></script><script src="txt-to-sql.js"> </script><script>var options = {};
var messages={
  es:{
      loading:'cargando',
      step2:'Paso 2: ',
      generate:'generar',
      generating:'generando',
      step3:'Paso 3: ',
      download:'descargar',
  },
  en:{
      loading:'loading',
      step2:'Step 2: ',
      generate:'generate',
      generating:'generating',
      step3:'Step 3: ',
      download:'download',
  }
}[window.lang||'es'];
function resetPage() {
    options = {
        verboseErrors:true,
        columnAlignedCommas:true
    };
    while(steps.lastChild) { steps.removeChild(steps.lastChild); }
    log.textContent="";
    errMessage.textContent="";
}
function processFile(file, messageText) {
    var tableName=file.name.replace(/^(.*[\\/])?([^\\/\.]+)\.[^\\/\.]+$/,'$2');
    log.textContent+="\n"+messageText+' '+file.name;
    var promise = new Promise(function(resolve, reject){
        try{
            var reader = new FileReader();
            reader.onload = function(event){
                resolve(event.target.result);
            };
            reader.readAsText(file);
        }catch(err){
            reject(err);
        }
    });
    return promise.then(function(txt){
        return {tableName:tableName, txt:txt, opts:options};
    }).catch(function(err){
        errMessage.textContent=err.message;
    });
}
function addStep(labelText, elements) {
    var div = document.createElement('div');
    var label = document.createElement('label');
    label.textContent = labelText;
    div.appendChild(label);
    elements.forEach(function(element) {
        div.appendChild(element);
    })
    steps.appendChild(div);
}
function handleGenerate(event){
    var file = event.target.file; // FileList object
    var tableName;
    processFile(file, messages.generating).then(function(param) {
        tableName=param.tableName;
        return generateScripts(param);
    }).then(function(generated) {
        if(generated.errors) { throw new Error(generated.errors.join('\n')); }
        var link = document.createElement('a');
        link.textContent = messages.download;
        var blob = new Blob(generated.sqls.map(function(sql) { return sql+'\n'; }), {type: 'text/plain'})
        link.setAttribute("download", tableName+".sql");    
        var url = URL.createObjectURL(blob); // "data:Application/octet-stream;base64," + blob.;
        link.href=url;
        addStep(messages.step3, [link]);
    }).catch(function(err){
        errMessage.textContent=err.message;
    });
}
function handlePrepare(event){
    var files = event.target.files; // FileList object
    resetPage();
    Array.prototype.forEach.call(files, function(file){
        processFile(file, messages.loading).then(function(param) {
            return prepare(param);
        }).then(function(prepared) {
            if(prepared.errors) { throw new Error(prepared.errors.join('\n')); }
            //log.textContent += '\n'+JSON.stringify(prepared);
            var button = document.createElement('input');
            button.type = 'button';
            button.file = file;
            button.value = messages.generate;
            button.addEventListener('click', handleGenerate, false);
            addStep(messages.step2, [button]);
        }).catch(function(err){
            errMessage.textContent=err.message;
        });
    });
}
document.getElementById('inputFile').addEventListener('change', handlePrepare, false);
// para el F5 post "npm run web"
resetPage();
inputFile.value = "";</script></html>